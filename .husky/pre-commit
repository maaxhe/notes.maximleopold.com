#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Format code
echo "üìù Formatting code..."
npm run format

# Check for secrets in staged files
echo "üîê Checking for potential secrets..."
if git diff --cached --name-only | grep -E '\.(md|ts|js|json)$' > /dev/null; then
  if git diff --cached | grep -iE '(password|secret|token|api[_-]?key|private[_-]?key).*[:=].*["\047][^"\047]{8,}["\047]' > /dev/null; then
    echo "‚ùå WARNING: Potential secrets detected in staged files!"
    echo "Please review your changes and remove any sensitive information."
    echo "If this is a false positive, you can skip this check with --no-verify"
    exit 1
  fi
fi

# Check that Private content is not being committed
echo "üîí Checking for private content..."
if git diff --cached --name-only | grep -iE '(private|secret|\.env|credentials)' > /dev/null; then
  echo "‚ùå WARNING: Attempting to commit private content!"
  echo "Files matching private patterns should not be committed."
  echo "Please review .gitignore and your staged files."
  exit 1
fi

echo "‚úÖ Pre-commit checks passed!"
